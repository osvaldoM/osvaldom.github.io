{"hash":"4358adcc5242314430677ea8b879a38f53f0aacf","data":{"article":{"id":"07236f06af36b775f70bed77b91bf933","title":"Preloading urls on hover using vue custom directives","content":"<p>I recently added a functionality in which when a user hovered over a certain link on my page,\nI would preload the url to where that link pointed.\nThe benefits and limitations around this are clearly explained in this <a href=\"http://instantclick.io/\" target=\"_blank\" rel=\"noopener\">post</a> from <a href=\"http://instantclick.io/\" target=\"_blank\" rel=\"noopener\">instantclick.io</a>,\nbut in summary:</p>\n<blockquote>\n<p>Before visitors click on a link, they hover over that link. Between these two events, 200 ms to 300 ms usually pass by (test yourself here). InstantClick makes use of that time to preload the page, so that the page is already there when you click.</p>\n</blockquote>\n<p>Here is what happens with this approach:</p>\n<ul>\n<li>User hovers over a link on the page;</li>\n<li>We send a GET request to the value of the link's href property;</li>\n<li>By the time the user clicks on the link, the page will already be in the cache(or at least, connection latency will have decreased).</li>\n</ul>\n<p>I firstly implemented this as follows:</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/page-to-be-preloaded<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">v-on:</span>mouseover.once</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>preload<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span> Hover over me to preload<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token punctuation\">{</span>\n  methods<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">preload</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>target<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetching'</span><span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">.</span><span class=\"token property-access\">href</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span><span class=\"token property-access\">href</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>I noticed that this preload technique could be reused in other parts of my application, but adding\na component for a pre-load link seemed cumbersome, since this doesn't declare any reusable HTML\nor require any state management, so I decided to use custom directives, which are another form of code reusability in vue that\nallows us to work directly with DOM elements.</p>\n<p>To achieve that, first lets create a directive :</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword module\">export</span> <span class=\"token keyword\">const</span> preloadOnHover <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function\">inserted</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">.</span><span class=\"token property-access\">tagName</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'preload directive added to non-link element'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">if</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">.</span><span class=\"token property-access\">href</span> <span class=\"token operator\">===</span> <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">location</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">href</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//We could even validate the url here.</span>\n            <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n        el<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mouseover'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>target<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'preloading'</span><span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">.</span><span class=\"token property-access\">href</span><span class=\"token punctuation\">)</span>\n            <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span><span class=\"token property-access\">href</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            once<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>A few things to note in this implementation are:</p>\n<ul>\n<li>We validate to see if the element we want to is a link and that it has the <code class=\"language-text\">href</code> attribute</li>\n<li>Since we passed a value of true to the <code class=\"language-text\">once</code> parameter, the event handler will only be executed once.</li>\n</ul>\n<p>In order to make use of our newly created directive, we just need to declare it as a directive in our component\nand then add it to our template as<code class=\"language-text\">v-preload-on-hover</code></p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/page-to-be-preloaded<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">v-preload-on-hover</span><span class=\"token punctuation\">></span></span> Hover to preload<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token comment\">&lt;!-- If using vue-router, we can add &lt;router-link v-preload-on-hover>&lt;/router-link> > --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span>preloadOnHover<span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'../directives'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token punctuation\">{</span>\n        directives<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            preloadOnHover\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<h1 id=\"a-few-things-we-should-take-into-consideration\"><a href=\"#a-few-things-we-should-take-into-consideration\" aria-hidden=\"true\"><span class=\"icon icon-link heading-anchor\"></span></a>A few things we should take into consideration</h1>\n<ul>\n<li>Whenever possible, consider using HTML resource hints(prefetch, preconnect, preload, etc) instead, to improve\nthe loading speed of pages/assets that are likely to be needed for the current/next navigation.</li>\n<li>Since we're using <code class=\"language-text\">mouseover</code> events, this only works on devices with a pointer/mouse, for devices with touch input,\nwe'd have to adapt this solution to use other events(eg: <code class=\"language-text\">touchstart</code>)</li>\n<li>This should be used carefuly, since we don't want to waste bandwidth by prefetching assets that might not be needed.\n</li>\n</ul>\n<p>The final code for this component can be seen in this <a href=\"https://codesandbox.io/s/wizardly-aryabhata-160c5?file=/src/components/HelloWorld.vue:0-220\" target=\"_blank\" rel=\"noopener\">code sandbox project</a>, and I hope you learned something interesting from this article.</p>\n<p>Happy coding!!ðŸš€ðŸš€ðŸš€ðŸš€ðŸš€</p>\n","published":"May 11, 2021","updated":"May 11, 2021","summary":"I recently added a functionality in which when a user hovered over a certain link on my page, I would preload the url to where that link pointed. The reasons and limi.....","tags":[{"title":"vue","path":"/blog/tag/vue/"}]}},"context":{}}